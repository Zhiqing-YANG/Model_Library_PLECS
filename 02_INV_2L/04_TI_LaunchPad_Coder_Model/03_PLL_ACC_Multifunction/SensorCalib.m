%% Sensor Calibration
% ########################################################################
% Sensor Calibration
% Establishment: 24.02.2021 Jiani He, PGS, RWTH Aachen
% #############################################################################

%% Board 1 - Sensor 1
% VPS
V_in = -100:10:100;
VPS1 = [0.963,1.016,1.071,1.124,1.177,1.231,1.285,1.338,1.393,1.446,1.498,1.55,1.603,1.658,1.711,1.765,1.819,1.873,1.925,1.98,2.033];
VPS2 = [0.958,1.011,1.067,1.12,1.174,1.228,1.282,1.336,1.391,1.444,1.495,1.549,1.602,1.657,1.71,1.764,1.818,1.873,1.926,1.981,2.034];
VPS3 = [0.957,1.010,1.065,1.118,1.172,1.225,1.279,1.332,1.387,1.44,1.492,1.544,1.597,1.652,1.705,1.759,1.812,1.866,1.919,1.974,2.027];

% a = 1/183.448;
% b = 1.497;
% y = a*V_in+b;

p1_v_1 = polyfit(V_in,VPS1,1);
y1 = polyval(p1_v_1,V_in); 

p1_v_2 = polyfit(V_in,VPS2,1);
y2 = polyval(p1_v_2,V_in); 

p1_v_3 = polyfit(V_in,VPS3,1);
y3 = polyval(p1_v_3,V_in); 

% figure()
% plot(V_in,VPS1,'*',V_in,y1)
% figure()
% plot(V_in,VPS2,'*',V_in,y2)
% figure()
% plot(V_in,VPS3,'*',V_in,y3)

% IPS
I_in = 11:-1:-11;
IPS1 = [2.262,2.191,2.121,2.051,1.981,1.911,1.84,1.77,1.7,1.629,1.559,1.488,1.417,1.347,1.277,1.206,1.136,1.065,0.995,0.925,0.855,0.785,0.714];
IPS2 = [2.268,2.197,2.127,2.058,1.987,1.917,1.846,1.776,1.706,1.635,1.565,1.495,1.423,1.353,1.282,1.212,1.142,1.071,1.001,0.931,0.861,0.791,0.721];
IPS3 = [2.271,2.200,2.130,2.061,1.991,1.920,1.850,1.779,1.709,1.639,1.569,1.498,1.426,1.356,1.285,1.215,1.145,1.075,1.004,0.934,0.864,0.794,0.724];

% a = 0.07047;
% b = 1.497;
% y = a*V_in+b;

p1_i_1 = polyfit(I_in,IPS1,1);
y1 = polyval(p1_i_1,I_in); 

p1_i_2 = polyfit(I_in,IPS2,1);
y2 = polyval(p1_i_2,I_in); 

p1_i_3 = polyfit(I_in,IPS3,1);
y3 = polyval(p1_i_3,I_in); 

% figure()
% plot(I_in,IPS1,'*',I_in,y1)
% figure()
% plot(I_in,IPS2,'*',I_in,y2)
% figure()
% plot(I_in,IPS3,'*',I_in,y3)

%% Board 2 - Sensor 2
% VPS
V_in = -100:10:100;
VPS1 = [0.952,1.002,1.057,1.11,1.165,1.219,1.273,1.326,1.381,1.434,1.486,1.539,1.592,1.648,1.701,1.755,1.808,1.862,1.914,1.969,2.022];
VPS2 = [0.952,1.006,1.061,1.114,1.168,1.222,1.277,1.33,1.385,1.438,1.49,1.542,1.595,1.651,1.704,1.758,1.812,1.866,1.919,1.975,2.028];
VPS3 = [0.963,1.016,1.072,1.125,1.179,1.232,1.287,1.34,1.395,1.447,1.5,1.551,1.605,1.66,1.713,1.768,1.822,1.876,1.928,1.984,2.038];

a = 1/183.448;
b = 1.497;
y = a*V_in+b;

p2_v_1 = polyfit(V_in,VPS1,1);
y1 = polyval(p2_v_1,V_in); 

p2_v_2 = polyfit(V_in,VPS2,1);
y2 = polyval(p2_v_2,V_in); 

p2_v_3 = polyfit(V_in,VPS3,1);
y3 = polyval(p2_v_3,V_in); 

figure()
plot(V_in,VPS1,'*',V_in,y1)
figure()
plot(V_in,VPS2,'*',V_in,y2)
figure()
plot(V_in,VPS3,'*',V_in,y3)

% IPS
I_in = 11:-1:-11;
IPS1 = [2.262,2.191,2.121,2.051,1.981,1.911,1.84,1.77,1.7,1.629,1.559,1.488,1.417,1.347,1.277,1.206,1.136,1.065,0.995,0.925,0.855,0.785,0.714];
IPS2 = [2.268,2.197,2.127,2.058,1.987,1.917,1.846,1.776,1.706,1.635,1.565,1.495,1.423,1.353,1.282,1.212,1.142,1.071,1.001,0.931,0.861,0.791,0.721];
IPS3 = [2.271,2.200,2.130,2.061,1.991,1.920,1.850,1.779,1.709,1.639,1.569,1.498,1.426,1.356,1.285,1.215,1.145,1.075,1.004,0.934,0.864,0.794,0.724];

% a = 0.07047;
% b = 1.497;
% y = a*V_in+b;

p2_i_1 = polyfit(I_in,IPS1,1);
y1 = polyval(p2_i_1,I_in); 

p2_i_2 = polyfit(I_in,IPS2,1);
y2 = polyval(p2_i_2,I_in); 

p2_i_3 = polyfit(I_in,IPS3,1);
y3 = polyval(p2_i_3,I_in); 

figure()
plot(I_in,IPS1,'*',I_in,y1)
figure()
plot(I_in,IPS2,'*',I_in,y2)
figure()
plot(I_in,IPS3,'*',I_in,y3)
